require 'readline'
require 'pathname'
require 'fileutils'

# Keyboard preferences
unless system 'defaults write -g InitialKeyRepeat -int 25 && defaults write -g KeyRepeat -int 2 && defaults write -g ApplePressAndHoldEnabled -bool false'
  raise 'Error setting keyboard preferences.'
end
puts 'Keyboard preferences set successfully'

# homebrew installation
unless system 'which brew'
  puts 'Installing homebrew...'
  unless system 'ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"'
    raise 'Error installing homebrew.'
  end
  puts 'homebrew successfully installed!'
else
  puts 'homebrew already installed.'
end

puts 'Tapping brew-bundle...'
unless system 'brew tap Homebrew/bundle'
  raise 'Error tapping Homebrew/bundle.'
end
puts 'brew-bundle successfully installed!'

# Brewfile installation
puts 'Installing Brewfile bundle...'
unless system 'brew bundle'
  raise 'Error installing Brewfile bundle.'
end
puts 'Brewfile bundle successfully installed!'

# oh-my-zsh installation
ohmyzsh_path = Pathname.new "#{Dir.home}/.oh-my-zsh"
unless ohmyzsh_path.exist?
  puts 'Installing oh-my-zsh...'
  unless system 'curl -L http://install.ohmyz.sh | sh'
    raise 'Error installing oh-my-zsh'
  end
  puts 'oh-my-zsh installed!'
else
  puts 'oh-my-zsh already installed.'
end

# Install powerline-fonts
FileUtils.cp Dir.glob("./vendor/powerline-fonts/SourceCodePro/*.otf"), "#{Dir.home}/Library/Fonts/"

# Symlinking things which need it
puts 'Linking VSCode configuration...'
FileUtils.ln_sf "#{Dir.home}/.homesick/repos/dotfiles/preferences/vscode/settings.json", "#{Dir.home}/Library/Application\ Support/Code/User/settings.json"
puts 'VSCode configuration linked successfully.'

# Private info prompts
email = Readline.readline('Email address: ')
unless system "git config --file ~/.gitconfig-private user.email #{email}"
  raise 'Error setting email address in git.'
end
puts 'Email address set in git global configuration'
